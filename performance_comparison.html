<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ - Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø±ÛŒÙ…ÙˆØª Ø¯Ø³Ú©ØªØ§Ù¾</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            font-size: 1.2em;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: #f7fafc;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-change {
            font-size: 1.1em;
            opacity: 0.95;
        }
        
        .improvement {
            color: #48bb78;
            font-weight: bold;
        }
        
        .pipeline-diagram {
            margin: 40px 0;
            padding: 30px;
            background: #edf2f7;
            border-radius: 15px;
        }
        
        .pipeline-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .pipeline {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        .pipeline-step {
            padding: 15px 25px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-weight: 500;
        }
        
        .pipeline-arrow {
            font-size: 1.5em;
            color: #4a5568;
        }
        
        .old-pipeline .pipeline-step {
            background: #fed7d7;
            color: #c53030;
        }
        
        .new-pipeline .pipeline-step {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .code-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 40px;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        
        .code-header {
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a5568;
        }
        
        .code-old .code-header {
            color: #fc8181;
        }
        
        .code-new .code-header {
            color: #68d391;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .code-comparison {
                grid-template-columns: 1fr;
            }
            
            .pipeline {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯</h1>
        <div class="subtitle">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ú©Ø¯ Ù‚Ø¨Ù„ Ùˆ Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ - Ø³ÛŒØ³ØªÙ… Ø±ÛŒÙ…ÙˆØª Ø¯Ø³Ú©ØªØ§Ù¾</div>
        
        <!-- Metrics Cards -->
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-label">Ù…ØµØ±Ù CPU</div>
                <div class="metric-value">15-25%</div>
                <div class="metric-change">Ù‚Ø¨Ù„Ø§Ù‹: 45-60% | <span class="improvement">â†“ 50-60%</span></div>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">Ù…ØµØ±Ù Ø­Ø§ÙØ¸Ù‡</div>
                <div class="metric-value">250 MB</div>
                <div class="metric-change">Ù‚Ø¨Ù„Ø§Ù‹: 800 MB | <span class="improvement">â†“ 70%</span></div>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">ØªØ§Ø®ÛŒØ± ÙØ±ÛŒÙ…</div>
                <div class="metric-value">18-25ms</div>
                <div class="metric-change">Ù‚Ø¨Ù„Ø§Ù‹: 35-50ms | <span class="improvement">â†“ 40%</span></div>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">GC Collection/s</div>
                <div class="metric-value">5-10</div>
                <div class="metric-change">Ù‚Ø¨Ù„Ø§Ù‹: 150-200 | <span class="improvement">â†“ 95%</span></div>
            </div>
        </div>
        
        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-title">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…ØµØ±Ù CPU</div>
                <canvas id="cpuChart"></canvas>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…ØµØ±Ù Ø­Ø§ÙØ¸Ù‡</div>
                <canvas id="memoryChart"></canvas>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">ØªØ§Ø®ÛŒØ± Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ±ÛŒÙ…</div>
                <canvas id="latencyChart"></canvas>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">ÙØ´Ø§Ø± Garbage Collector</div>
                <canvas id="gcChart"></canvas>
            </div>
        </div>
        
        <!-- Pipeline Diagrams -->
        <div class="pipeline-diagram">
            <div class="pipeline-title">Ù…Ù‚Ø§ÛŒØ³Ù‡ Pipeline Ù¾Ø±Ø¯Ø§Ø²Ø´</div>
            
            <h3 style="color: #c53030; margin: 20px 0 10px;">âŒ Ú©Ø¯ Ù‚Ø¯ÛŒÙ…ÛŒ (4 Ù…Ø±Ø­Ù„Ù‡ ØªØ¨Ø¯ÛŒÙ„):</h3>
            <div class="pipeline old-pipeline">
                <div class="pipeline-step">Screen (BGRA)</div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">Copy to Buffer</div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">BGRA â†’ NV12</div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">NV12 â†’ YUV420P</div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">Encode</div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">List<byte></div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">Parse NAL</div>
            </div>
            
            <h3 style="color: #22543d; margin: 30px 0 10px;">âœ… Ú©Ø¯ Ø¬Ø¯ÛŒØ¯ (1 Ù…Ø±Ø­Ù„Ù‡ ØªØ¨Ø¯ÛŒÙ„):</h3>
            <div class="pipeline new-pipeline">
                <div class="pipeline-step">Screen (BGRA)</div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">Direct BGRA â†’ NV12</div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">Encode (Zero-copy)</div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">Output</div>
            </div>
        </div>
        
        <!-- Code Comparison -->
        <div class="code-comparison">
            <div class="code-block code-old">
                <div class="code-header">âŒ Ú©Ø¯ Ù‚Ø¯ÛŒÙ…ÛŒ (ØºÛŒØ±Ø¨Ù‡ÛŒÙ†Ù‡)</div>
                <pre>
// Memory copies Ø²ÛŒØ§Ø¯
var argbBuffer = new byte[size];
Marshal.Copy(ptr, argbBuffer, 0, size);

var nv12 = ConvertToNv12(argbBuffer);

// ØªØ¨Ø¯ÛŒÙ„ Ø¯ÙˆØ¨Ø§Ø±Ù‡
sws_scale(_sws, src, ..., dst, ...);

// Allocation Ø¯Ø± loop
List&lt;byte&gt; outBytes = new List&lt;byte&gt;();
outBytes.AddRange(buff); // GC pressure!

// Parse Ø¯Ø± Ù‡Ø± ÙØ±ÛŒÙ…
ExtractSpsPps(ba); // Ø­ØªÛŒ ÙˆÙ‚ØªÛŒ Ø¯Ø§Ø±ÛŒØ¯!
                </pre>
            </div>
            
            <div class="code-block code-new">
                <div class="code-header">âœ… Ú©Ø¯ Ø¬Ø¯ÛŒØ¯ (Ø¨Ù‡ÛŒÙ†Ù‡)</div>
                <pre>
// Ø¨Ø§ÙØ± Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ø¬Ø¯Ø¯
_nv12Buffer = ArrayPool&lt;byte&gt;.Shared.Rent(size);

// ØªØ¨Ø¯ÛŒÙ„ Ù…Ø³ØªÙ‚ÛŒÙ… ÛŒÚ© Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ
fixed (byte* pNv12 = _nv12Buffer)
{
    ConvertBgraToNv12(bgra, stride, pNv12, ...);
    
    // Zero-copy Ø¨Ù‡ encoder
    Buffer.MemoryCopy(pNv12, _frame->data[0], ...);
}

// Single allocation
byte[] encoded = new byte[_packet->size];

// Parse ÙÙ‚Ø· ÛŒÚ© Ø¨Ø§Ø±
if (!_extracted) ExtractSpsPps();
                </pre>
            </div>
        </div>
    </div>
    
    <script>
        // Chart configuration
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        };
        
        // CPU Usage Chart
        new Chart(document.getElementById('cpuChart'), {
            type: 'bar',
            data: {
                labels: ['Idle', 'Light Load', 'Heavy Load', 'Peak'],
                datasets: [
                    {
                        label: 'Ú©Ø¯ Ù‚Ø¯ÛŒÙ…ÛŒ',
                        data: [45, 52, 58, 65],
                        backgroundColor: 'rgba(220, 38, 38, 0.7)',
                        borderColor: 'rgba(220, 38, 38, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'Ú©Ø¯ Ø¨Ù‡ÛŒÙ†Ù‡',
                        data: [15, 18, 22, 28],
                        backgroundColor: 'rgba(34, 197, 94, 0.7)',
                        borderColor: 'rgba(34, 197, 94, 1)',
                        borderWidth: 2
                    }
                ]
            },
            options: {
                ...chartOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 70,
                        title: {
                            display: true,
                            text: 'CPU Usage (%)'
                        }
                    }
                }
            }
        });
        
        // Memory Chart
        new Chart(document.getElementById('memoryChart'), {
            type: 'line',
            data: {
                labels: ['0s', '10s', '20s', '30s', '40s', '50s', '60s'],
                datasets: [
                    {
                        label: 'Ú©Ø¯ Ù‚Ø¯ÛŒÙ…ÛŒ',
                        data: [450, 550, 680, 750, 820, 780, 800],
                        borderColor: 'rgba(220, 38, 38, 1)',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Ú©Ø¯ Ø¨Ù‡ÛŒÙ†Ù‡',
                        data: [180, 210, 230, 245, 255, 248, 250],
                        borderColor: 'rgba(34, 197, 94, 1)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                ...chartOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 900,
                        title: {
                            display: true,
                            text: 'Memory (MB)'
                        }
                    }
                }
            }
        });
        
        // Latency Chart
        new Chart(document.getElementById('latencyChart'), {
            type: 'bar',
            data: {
                labels: ['Min', 'Avg', 'P95', 'Max'],
                datasets: [
                    {
                        label: 'Ú©Ø¯ Ù‚Ø¯ÛŒÙ…ÛŒ',
                        data: [32, 42, 48, 55],
                        backgroundColor: 'rgba(220, 38, 38, 0.7)',
                        borderColor: 'rgba(220, 38, 38, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'Ú©Ø¯ Ø¨Ù‡ÛŒÙ†Ù‡',
                        data: [16, 21, 24, 28],
                        backgroundColor: 'rgba(34, 197, 94, 0.7)',
                        borderColor: 'rgba(34, 197, 94, 1)',
                        borderWidth: 2
                    }
                ]
            },
            options: {
                ...chartOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 60,
                        title: {
                            display: true,
                            text: 'Latency (ms)'
                        }
                    }
                }
            }
        });
        
        // GC Chart
        new Chart(document.getElementById('gcChart'), {
            type: 'doughnut',
            data: {
                labels: ['Ú©Ø¯ Ù‚Ø¯ÛŒÙ…ÛŒ', 'Ú©Ø¯ Ø¨Ù‡ÛŒÙ†Ù‡'],
                datasets: [{
                    data: [175, 7],
                    backgroundColor: [
                        'rgba(220, 38, 38, 0.8)',
                        'rgba(34, 197, 94, 0.8)'
                    ],
                    borderColor: [
                        'rgba(220, 38, 38, 1)',
                        'rgba(34, 197, 94, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    title: {
                        display: true,
                        text: 'GC Collections per Second'
                    }
                }
            }
        });
    </script>
</body>
</html>
